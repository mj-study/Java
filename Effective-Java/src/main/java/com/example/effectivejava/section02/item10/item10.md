### ì•„ë˜ì™€ ê°™ì€ ìƒí™©ì—ì„œëŠ” `equals` ì¬ì •ì˜ í•˜ì§€ ì•ŠëŠ”ê²Œ ì¢‹ìŒ

1. ê° ì¸ìŠ¤í„´ìŠ¤ê°€ ë³¸ì§ˆì ìœ¼ë¡œ ê³ ìœ í•œ ê²½ìš°
    - ê°’ì„ í‘œí˜„í•˜ëŠ”ê²Œ ì•„ë‹Œ ë™ì‘ìœ¼ë¡œ ê°œì²´ë¥¼ í‘œí˜„í•˜ëŠ” ê²½ìš° í•´ë‹¹
    - `Thread`ê°€ ì¢‹ì€ ì˜ˆ

        ```java
        @Override
        public boolean equals(Object obj) {
            if (obj == this)
                return true;
        
            if (obj instanceof WeakClassKey) {
                Class<?> referent = get();
                return (referent != null) &&
                        (((WeakClassKey) obj).refersTo(referent));
            } else {
                return false;
            }
        }
        ```

2. ì¸ìŠ¤í„´ìŠ¤ì˜ ë…¼ë¦¬ì  ë™ì¹˜ì„±ì„ ê²€ì‚¬í•  ì¼ì´ ì—†ëŠ” ê²½ìš°
    - ì˜ˆë¥¼ ë“¤ì–´, `Pattern` í´ë˜ìŠ¤ëŠ” `equals`ë¥¼ ì¬ì •ì˜ í•´ì„œ ë‘ ì¸ìŠ¤í„´ìŠ¤ê°€ ê°™ì€ ì •ê·œ í‘œí˜„ì‹ì„ ë‚˜íƒ€ë‚´ëŠ”ì§€ë¥¼ ê²€ì‚¬í•˜ëŠ”(ë…¼ë¦¬ì  ë™ì¹˜ì„± ê²€ì‚¬) ë°©ë²•ì´ ìˆì„ ìˆ˜ ìˆì§€ë§Œ ê°œë°œìê°€ ì •ê·œ í‘œí˜„ì‹ì´ ë™ì¼í•œì§€ íŒë‹¨í•˜ëŠ”ê±°ë¼ë©´ `Object` ì˜ `equals`ë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤.
3. ìƒìœ„ í´ë˜ìŠ¤ì—ì„œ ì¬ì •ì˜í•œ `equals`ê°€ í•˜ìœ„ í´ë˜ìŠ¤ì—ë„ ë§ëŠ” ê²½ìš°
    - ì˜ˆë¥¼ ë“¤ì–´, ëŒ€ë¶€ë¶„ì˜ `Set` êµ¬í˜„ì²´ëŠ” `AbstractSet` ì´ êµ¬í˜„í•œ `equals` ìƒì†ë°›ì•„ ì‚¬ìš©
      `List` â†’ `AbstractList`, `Map` â†’ `AbstractMap`
    - ì´ëŸ° ê²½ìš°ë“¤ì€ êµ³ì´ ì¬ì •ì˜í•  í•„ìš” ì—†ìŒ
4. í´ë˜ìŠ¤ê°€ `private`ì´ê±°ë‚˜ `package-private`ì´ê³  `equals` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ì¼ì´ ì—†ëŠ” ê²½ìš°
    - í˜¹ì‹œë‚˜ ë‹¤ë¥¸ ê³³ì—ì„œ í˜¸ì¶œë˜ëŠ” ê²½ìš°ë¥¼ ë§‰ìœ¼ë ¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•˜ì

    ```java
    @Override 
    public boolean equals(Objet o) {
      throw new AssertionError();
    }
    ```


>  ê·¸ë ‡ë‹¤ë©´ `equals`ê°€ ì¬ì •ì˜ ë˜ì–´ì•¼í• ë•ŒëŠ”?  
> - ê°ì²´ ì‹ë³„ì„±(ë¬¼ë¦¬ì ìœ¼ë¡œ x) ì•„ë‹ˆë¼ ë…¼ë¦¬ì  ë™ì¹˜ì„±ì„ í™•ì¸í•´ì•¼í•  ë•Œ, ìƒìœ„ í´ë˜ìŠ¤ì˜ `equals`ê°€ ë…¼ë¦¬ì  ë™ì¹˜ì„±ì„ ë¹„êµí•˜ë„ë¡ ì¬ì •ì˜ë˜ì§€ ì•Šì•˜ì„ ë•Œ  
> - ì£¼ë¡œ ê°’ í´ë˜ìŠ¤ë“¤ì´ ì—¬ê¸°ì— í•´ë‹¹ë¨ â‡’ Integer, String ê³¼ ê°™ì€ í´ë˜ìŠ¤  
> - ê°’ í´ë˜ìŠ¤ë¼ í•´ë„ ì‹±ê¸€í„´ íŒ¨í„´ì²˜ëŸ¼ ê°’ì´ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ê°€ ë‘˜ ì´ìƒ ë§Œë“¤ì–´ì§€ì§€ ì•ŠëŠ” í´ë˜ìŠ¤ëŠ” ì¬ì •ì˜ í•  í•„ìš” x , `enum` ë„ í•´ë‹¹

---

## ğŸ“Œ `equals` ì¬ì •ì˜ì‹œ ì¼ë°˜ ê·œì•½

- ì•„ë˜ëŠ” `Object` ëª…ì„¸ì— ì íŒ ê·œì•½

| ë°˜ì‚¬ì„±(reflexivity) | nullì´ ì•„ë‹Œ ëª¨ë“  ì°¸ì¡° ê°’ xì— ëŒ€í•´, x.equals(x) ëŠ” true |
| --- | --- |
| ëŒ€ì¹­ì„±(symmetry) | nullì´ ì•„ë‹Œ ëª¨ë“  ì°¸ì¡° ê°’ x, yì— ëŒ€í•´ x.equals(y)ê°€ true ë©´ y.equals(x) ë„ true |
| ì¶”ì´ì„±(transitivity) | nullì´ ì•„ë‹Œ ëª¨ë“  ì°¸ì¡° ê°’ x,y,zì— ëŒ€í•´ x.equals(y) trueì´ê³  y.equals(z) trueì´ë©´ x.equals(z)ë„ true |
| ì¼ê´€ì„±(consistency) | nullì´ ì•„ë‹Œ ëª¨ë“  ì°¸ì¡° ê°’ x,yì— ëŒ€í•´ x.equals(y)ë¥¼ ë°˜ë³µí•´ì„œ í•­ìƒ trueë¥¼ ë°˜í™˜í•˜ê±°ë‚˜ falseë¥¼ ë°˜í™˜ |
| null-ì•„ë‹˜ | nullì´ ì•„ë‹Œ ëª¨ë“  ì°¸ì¡° ê°’ xì— ëŒ€í•´, x.equals(null)ì€ false |

### ì‚¬ìš©í• ë§Œí•œ equalsê°€ ë˜ë ¤ë©´?

- ëª¨ë“  ì›ì†Œê°€ ê°™ì€ ë™ì¹˜ë¥˜ì— ì†í•œ ì–´ë–¤ ì›ì†Œì™€ë„ ì„œë¡œ êµí™˜í•  ìˆ˜ ìˆì–´ì•¼ í•¨
- **ë°˜ì‚¬ì„±**ì€ â†’ ìê¸° ê°ì²´ì™€ ê°™ì•„ì•¼í•¨
- **ëŒ€ì¹­ì„±**ì€ â†’ ë‘ ê°ì²´ëŠ” ì„œë¡œì— ëŒ€í•œ ë™ì¹˜ ì—¬ë¶€ë¥¼ ë˜‘ê°™ì´ ë‹µí•´ì•¼í•¨

> ëŒ€ì¹­ì„± ìœ„ë°°ë˜ëŠ”ê²½ìš°ì™€ ê°œì„  ì‚¬í•­
>

```java
/**
 * ëŒ€ì¹­ì— ëŒ€í•œ ë™ì¹˜ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤
 */
public class CaseInsensitiveString {
	private final String s;

	public CaseInsensitiveString(String s) {
		this.s = Objects.requireNonNull(s);
	}

	// ëŒ€ì¹­ì„± ìœ„ë°°ë˜ëŠ” ê²½ìš°
	@Override
	public boolean equals(Object o) {
		if (o instanceof CaseInsensitiveString) {
			return s.equalsIgnoreCase(
				((CaseInsensitiveString)o).s
			);
		}
		
		// ì´ ë¶€ë¶„ì—ì„œ ë‹¤ë¥¸ String.equals(o) í•  ê²½ìš° ë‹¤ë¥¸ ê²½ìš°ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆìŒ
		if (o instanceof String) {
			return s.equalsIgnoreCase((String) o);
		}
		return false;	
	}
}
```

```java
	@Test
	void ëŒ€ì¹­ì„±_ìœ„ë°° () {
		String word = "test";
		CaseInsensitiveString caseWord = new CaseInsensitiveString("Test");

		boolean sToC = word.equalsIgnoreCase(caseWord.toString()); // ì˜ˆìƒê²°ê³¼ -> false
		boolean cToS = caseWord.equals(word); // ì˜ˆìƒê²°ê³¼ -> true
		System.out.printf("sToC : %b, cToS : %b\n", sToC, cToS);
		assertNotEquals(sToC, cToS);
	}
```

- í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì„œë¡œ ë‹¤ë¥¸ ê°’ì´ ë‚˜ì˜¨ë‹¤.
- `CaseInsensitiveString` equalsëŠ” ì¼ë°˜ Stringì„ ì•Œì§€ë§Œ, `String` ì˜ equals ëŠ” `CaseInsensitiveString` ì¡´ì¬ë¥¼ ëª¨ë¦„

```java
	@Test
	void list_ë¹„êµ () {
		String word = "test";
		CaseInsensitiveString cis = new CaseInsensitiveString(word);
		List<CaseInsensitiveString> list = new ArrayList<>();
		list.add(cis);

		boolean res = list.contains(word);
		System.out.printf("ê²°ê³¼ : %s\n", res);
		assertFalse(res);
	}
```

- collection ê°ì²´ë„ ë§ˆì°¬ê°€ì§€ë¡œ equalsì˜ ê²°ê³¼ëŠ” false

```java
	@Override
	public boolean equals(Object o) {
		return o instanceof CaseInsensitiveStringV2 &&
			((CaseInsensitiveStringV2)o).s.equalsIgnoreCase(s);
	}
```

- ê°™ì€ í´ë˜ìŠ¤ íƒ€ì…ì¼ë•Œë§Œ ë¹„êµí•˜ê²Œ ë³€ê²½í•˜ë©´ ëŒ€ì¹­ì„± ìœ„ë°°ëŠ” í•´ê²°



> ì¶”ì´ì„± ìœ„ë°°ë˜ëŠ” ê²½ìš°?
êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ í™•ì¥í•´ ìƒˆë¡œìš´ ê°’ì„ ì¶”ê°€í•˜ë©´ì„œ `equals` ê·œì•½ì„ ë§Œì¡±ì‹œí‚¬ ë°©ë²•ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
>
- êµ¬ì²´ í´ë˜ìŠ¤ì˜ í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ ê°’ì„ ì¶”ê°€í•  ë°©ë²•ì€ ì—†ì§€ë§Œ, ìš°íšŒí•´ì„œ ì‚¬ìš©
    - ìƒì† ëŒ€ì‹  **ì»´í¬ì§€ì…˜ ì‚¬ìš©**
    - `Point`ë¥¼ ìƒì†í•˜ëŠ” ëŒ€ì‹  `Point` ë¥¼ `ColorPoint`ì˜ private í•„ë“œë¡œ ë‘ê³  ì¼ë°˜ `Point`ë¥¼ ë°˜í™˜í•˜ëŠ” view ë©”ì„œë“œë¥¼ public ì¶”ê°€


> ì¼ê´€ì„±ì€ í´ë˜ìŠ¤ê°€ ë¶ˆë³€ì´ë“  ê°€ë³€ì´ë“  `equals` íŒë‹¨ì— ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ìì›ì´ ë¼ì–´ë“¤ê²Œ í•´ì„œëŠ” ì•ˆë¨
>
- ì˜ˆë¥¼ ë“¤ì–´ `URL` í´ë˜ìŠ¤ì˜ equalsëŠ” ì£¼ì–´ì§„ URLê³¼ ë§¤í•‘ëœ í˜¸ìŠ¤íŠ¸ì˜ IP ì£¼ì†Œë¥¼ ì´ìš©í•´ ë¹„êµí•¨
  â‡’ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ IP ì£¼ì†Œë¡œ ë³€ê²½í•˜ë©´ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ì•¼ í•˜ëŠ”ë°, í•­ìƒ ê²°ê³¼ê°€ ê°™ë‹¤ê³  ë³´ì¥í•  ìˆ˜ ì—†ìŒ

> null-ì•„ë‹˜
>
- ëª¨ë“  ê°ì²´ê°€ `null`ê³¼ ê°™ì§€ ì•Šì•„ì•¼ í•¨
- `o.equals(null)` ì´ trueë¥¼ ë°˜í™˜xí•˜ê²Œ í•´ì„œëŠ” ì•ˆë¨

```java
// ëª…ì‹œì  null ê²€ì‚¬ í•  í•„ìš” ì—†ìŒ
@Override
public boolean equals(Object o) {
  if (o == null) {
    return false;
  } 
}

// ë¬µì‹œì  null ê²€ì‚¬
@Override
public boolean equals(Object o) {
  if (!(o instanceof MyType) {
    ...
  } 
}
```

---

### ì •ë¦¬

1. `==` ì—°ì‚°ìë¥¼ ì‚¬ìš©í•´ ì…ë ¥ì´ ìê¸° ìì‹ ì˜ ì°¸ì¡°ì¸ì§€ í™•ì¸
    - ìê¸° ìì‹ ì´ë©´ true ë°˜í™˜ â‡’ ë‹¨ìˆœí•œ ì„±ëŠ¥ ìµœì í™”ìš©
    - ë¹„êµ ì‘ì—…ì´ ë³µì¡í•œ ìƒí™©ì¼ ë•Œ ê°’ì–´ì¹˜ë¥¼ í•  ê²ƒì„
2. `instanceof` ì—°ì‚°ìë¡œ ì…ë ¥ë”” ì˜¬ë°”ë¥¸ íƒ€ì…ì¸ì§€ í™•ì¸
3. ì…ë ¥ì„ ì˜¬ë°”ë¥¸ íƒ€ì…ìœ¼ë¡œ í˜•ë³€í™˜í•¨
    - Java16 ì— ì¶”ê°€ëœ `instanceof pattern` ì‚¬ìš©í•˜ë©´ í¸ë¦¬
      â‡’ ex) `if ( !(o instanceof Mytype type){}`
4. ì…ë ¥ ê°ì²´ì™€ ìê¸° ìì‹ ì˜ ëŒ€ì‘ë˜ëŠ” í•µì‹¬ í•„ë“œë“¤ì´ ëª¨ë‘ ì¼ì¹˜í•˜ëŠ”ì§€ í•˜ë‚˜ì”© ê²€ì‚¬
    - `float` ê³¼ `double`í•„ë“œëŠ” ê°ê° ì •ì  ë©”ì„œë“œì¸ `Float.compare(x1,x2)` `Double.compare(x1,x2)` ì´ìš©
      â‡’ ë¶€ë™ì†Œìˆ˜ë¥¼ ë‹¤ë¤„ì•¼ í•˜ê¸°ë•Œë¬¸ì— ìœ„ì˜ ë©”ì„œë“œ ì‚¬ìš©
      â‡’ `equals` ì‚¬ìš©í•˜ê²Œ ëœë‹¤ë©´ ì˜¤í† ë°•ì‹±ì„ ìˆ˜ë°˜í•  ìˆ˜ ìˆìœ¼ë‹ˆ ì„±ëŠ¥ìƒ ì¢‹ì§€ ì•ŠìŒ

- ë°°ì—´ì˜ ëª¨ë“  ì›ì†Œê°€ í•µì‹¬ í•„ë“œë¼ë©´ `Arrays.equals` ë©”ì„œë“œë“¤ ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš© ê¶Œì¥
- nullë„ ì •ìƒ ê°’ìœ¼ë¡œ ì·¨ê¸‰í•˜ëŠ” ì°¸ì¡° íƒ€ì… í•„ë“œë¼ë©´ NPE ì˜ˆë°©ì„ ìœ„í•´ `Objects.equals(o1,o2)` ë¹„êµ

> ë³µì¡í•œ í•„ë“œë¥¼ ê°€ì§„ í´ë˜ìŠ¤ë¥¼ ë¹„êµí• ë•Œ
>
- í•„ë“œì˜ í‘œì¤€í˜•(canonical form)ì„ ì €ì¥í•´ë‘” í›„ í‘œì¤€í˜•ë¼ë¦¬ ë¹„êµí•˜ë©´ í›¨ì”¬ ê²½ì œì 
  â‡’ ë¶ˆë³€ í´ë˜ìŠ¤ì— ì œê²©
- ë™ê¸°í™”ìš© lock í•„ë“œ ê°™ì´ ê°ì²´ì˜ ë…¼ë¦¬ì  ìƒíƒœì™€ ê´€ë ¨ì—†ëŠ” í•„ë“œëŠ” ë¹„êµí•˜ë©´ ì•ˆë¨!
- í•µì‹¬ í•„ë“œë¡œë¶€í„° ê³„ì‚°í•´ë‚¼ ìˆ˜ ìˆëŠ” íŒŒìƒ í•„ë“œë¥¼ êµ³ì´ ë¹„êµí•  í•„ìš”ëŠ” ì—†ì§€ë§Œ, íŒŒìƒ í•„ë“œë¥¼ ë¹„êµí•˜ëŠ”ê²Œ ë” ë¹ ë¥¼ë•Œë„ ìˆë‹¤
    - ìì‹ ì˜ ì˜ì—­ì„ ìºì‹œì— ì €ì¥í•  ê²½ìš° ìºì‹œí•´ë‘” ì˜ì—­ë§Œ ë¹„êµí•˜ë©´ ê²°ê³¼ë¥¼ ê³§ ë°”ë¡œ ë³¼ ìˆ˜ ìˆìŒ

> âš ï¸ equals êµ¬í˜„ì„ ë‹¤í–ˆë‹¤ë©´ 3ê°€ì§€ ì ê²€í•˜ê¸°
>
1. ëŒ€ì¹­ì ì¸ê°€?
2. ì¶”ì´ì„±ì´ ìˆëŠ”ê°€?
3. ì¼ê´€ì ì¸ê°€?

### ì£¼ì˜ì‚¬í•­

- `equals` ì¬ì •ì˜í•  ë• `hashCode`ë„ ë°˜ë“œì‹œ ì¬ì •ì˜
- ë„ˆë¬´ ë³µí•©í•˜ê²Œ í•´ê²°í•˜ë ¤ê³  x
- `Object` ì™¸ì˜ íƒ€ì…ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ” `equals` ë©”ì„œë“œëŠ” ì„ ì–¸x
    - ì˜¤ë²„ë¡œë”© ì£¼ì˜! ì•„ë˜ëŠ” ì¬ì •ì˜(ì˜¤ë²„ë¼ì´ë”©)í•œê²Œ ì•„ë‹ˆë¼ ë‹¤ì¤‘ ì •ì˜(ì˜¤ë²„ë¡œë”©) í•œê²ƒ
      â‡’ ex) `public boolean equals(MyClass o) {}`
    - `@Override` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œ  ë¯¸ë¦¬ ì˜ˆë°© ê°€ëŠ¥
- ê¼­ í•„ìš”í•œê²Œ ì•„ë‹ˆë©´ `equals` ì¬ì •ì˜í•˜ì§€ ë§ê²ƒ

### ê¿€íŒ?

- êµ¬ê¸€ì´ ë§Œë“  `AutoValue` í”„ë ˆì„ì›Œí¬
- `Lombok` ê³¼ ì°¨ì´ëŠ”?